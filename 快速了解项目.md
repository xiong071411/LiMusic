# AI 助手快速上手指南（LiMusic Android）

> **新对话开始时请先阅读本文件**

---

## 1. 项目基础信息

- **项目名称**: LiMusic
- **平台 / 语言**: Android ‑ Kotlin & Java + XML 布局
- **最低 / 目标 SDK**: minSdk 24 / targetSdk 34
- **构建工具**: Gradle (Android Gradle Plugin 8.x)
- **主要功能**:
  1. 本地音频扫描与展示
  2. 前台 `PlayerService` 播放音乐
  3. `MainActivity` 内嵌简洁播放器（播放 / 循环、圆角进度条、SeekBar）
  4. 通知栏控制、耳机按键响应（预留）

## 2. 必读文档优先级
1. **快速了解项目.md**（本文） – 快速熟悉整体
2. **开发日志.md** – 查看最近一次修改内容
3. **app/** 源码目录 – 查阅核心实现
4. **res/layout/activity_main.xml** – 了解当前播放器 UI

> 目前尚未建立 docs/ 与 dev-docs/ 目录，如有需要请在后续迭代中补充。

## 3. 核心开发规范 ⚠️
```
- 遵循官方 Android Kotlin 编码规范
- UI 仅使用 XML 布局（暂不引入 Jetpack Compose）
- 所有字符串放入 res/values/strings.xml
- 图片矢量优先使用 VectorDrawable，放入 res/drawable/
- Service 与 Activity 之间通过 Intent & Broadcast 交互，不使用全局单例
- 不在 UI 线程做耗时操作，使用协程或线程池
```

## 4. 代码包结构与核心类
下表按 **包 → 类 / 目录 → 作用** 列出核心文件，便于 AI 快速定位：

| 包 / 目录 | 关键类或文件 | 说明 |
| --- | --- | --- |
| `com.watch.limusic` | `MainActivity.java` | 主界面：歌曲列表 + 底部迷你播放器 |
|  | `SettingsActivity.java` | 设置入口，嵌入 `SettingsFragment` 列表 |
|  | `CacheSettingsActivity.java` | 缓存相关设置页面 |
|  | `NavidromeSettingsActivity.java` | 远程服务器（Navidrome）配置页面 |
| `com.watch.limusic.service` | `PlayerService.java` | 前台音乐播放，负责 ExoPlayer 生命周期、通知栏控制、广播通信 |
| `com.watch.limusic.adapter` | `SongAdapter.java`<br>`AlbumAdapter.java` | RecyclerView 适配器：歌曲 / 专辑列表 |
| `com.watch.limusic.util` | `PinyinUtil.java` | 使用 pinyin4j 进行中文转拼音首字母排序 |
|  | `SwipeGestureListener.java` | 处理列表快滑手势 |
| 其他 | `res/layout/*` | XML 布局（详见下一节） |

> 若需新增功能，请遵循现有包命名风格；将复用性高的逻辑放入 `util/`，UI 列表相关放入 `adapter/`。

## 5. 资源与布局
| 资源类别 | 目录 | 说明 |
| --- | --- | --- |
| 布局（Layout） | `res/layout/` | `activity_main.xml` 播放器 + 列表<br>`activity_settings*.xml` 系列设置页面<br>`item_song.xml`/`item_album.xml` 列表项 |
| 图标 / Shape | `res/drawable/` | 含自定义圆角进度条 `progress_bar_rounded.xml`、播放/上一曲/下一曲 VectorDrawable 等 |
| 颜色 | `res/color/` | 主题色、透明蒙层 |
| 字符串 | `res/values/strings.xml` | 所有 UI 文本，与代码严格分离 |

布局命名规范：`activity_*`、`item_*`、`layout_*`，避免歧义。

## 6. 权限与 Feature 声明
来自 `AndroidManifest.xml`：
```
INTERNET / ACCESS_NETWORK_STATE   # 网络请求 & 状态检测
WAKE_LOCK                         # 保持播放时 CPU 运转
MODIFY_AUDIO_SETTINGS             # 调整音频焦点
FOREGROUND_SERVICE*               # 前台播放服务
<uses-feature android.hardware.type.watch />  # 穿戴设备
```
如需新增权限，请在 Manifest 中注释用途并同步更新本表。

## 7. 第三方库清单（Gradle）
```
- ExoPlayer          2.18.7   # 音频播放
- Retrofit + Gson    2.9.0    # HTTP API 访问
- OkHttp Logging     4.11.0   # 网络日志
- Glide              4.11.0   # 图片加载
- Kotlin Coroutines  1.6.4    # 异步
- Navigation KTX     2.5.3    # Fragment 导航
- Pinyin4j           2.5.1    # 拼音转换 (排序)
```
> 升级库时请注意 `minSdk 27` 与 `targetSdk 33` 的兼容性。

## 8. 构建 / 版本策略
- Java & Kotlin 混编，`sourceCompatibility`/`jvmTarget` 均为 **17**。
- **版本号**：`versionCode` 递增整数，`versionName` 采用 `Major.Minor.Patch`；当前 `1.9992` 表示即将进入 2.0。
- 发布前需通过 **release** 构建 (关闭 `minifyEnabled` = false，可后续启用 R8)。

## 9. 运行时通信
- **Activity ↔︎ Service**：`Intent` + `startForegroundService()` 保持播放，`PlayerService` 通过 `LocalBroadcastManager`（后续可迁移到 `LiveData`）回传状态。
- **UI 事件**：按钮直接调用 `PlayerService` 公开方法；进度条改变通过 Seek 到指定位置。

## 10. 未来迭代 TODO
1. **通知栏媒体控制**（进行中） – 在 `PlayerService` 添加 `MediaStyle` 通知。
2. **耳机线控 / 蓝牙按键** – 监听 `AudioManager.ACTION_AUDIO_BECOMING_NOISY` 等广播。
3. **Jetpack Media3** – 考虑迁移以获得官方推荐 API。
4. **离线缓存管理** – 扩展 `CacheSettingsActivity`，支持手动清理。

## 11. 当前重点功能模块
| 模块 | 状态 | 说明 |
| --- | --- | --- |
| 播放器 UI 优化 | ✅ 已完成 | 详见 `activity_main.xml` |
| 通知栏控制 | 🔄 进行中 | 待实现 `NotificationManager` |
| 媒体库扫描 | ✅ 已完成 | 详见 `MediaUtils` |

## 12. 开发 & 调试
- **运行 / 调试**: Android Studio → 选择真机 / 模拟器 → 运行 `app`。
- **日志查看**: 使用 Logcat，所有调试日志统一使用 `TAG = "LiMusic"`。
- **单元测试**: 暂未添加，可在 `app/src/test` 目录创建。

## 13. 快速检查清单
- [ ] 阅读开发日志，确认最新 UI / 逻辑改动
- [ ] 明确当前需求所属功能（UI / 播放 / 通知等）
- [ ] 检查 `strings.xml` 是否已有所需文本
- [ ] 检查 `drawable/` 是否已有相应图标 / shape
- [ ] 修改代码后运行 Lint 与编译，确保无错误

## 14. 贡献文档体系（待补充）
随着功能扩展，建议在根目录新增：
```
docs/           # 面向前端 / 测试的 API 文档
dev-docs/       # 详细功能设计文档
```
并在此文件 **"2. 必读文档优先级"** 中补充相应链接。

---
**最后更新**: 2024-XX-XX 